<div class="container">
  <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="left-panel">
    <button class="back-button" (click)="goToJournal()">
      &#x2190; –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∂—É—Ä–Ω–∞–ª—É
    </button>
    <h3>–ö–æ–º–∞–Ω–¥—ã</h3>
    <div class="commands">
      <div *ngFor="let cmd of commandsList" 
        class="command" 
        draggable="true" 
        (dragstart)="dragCommand(cmd.name)">
        {{ cmd.label }}
      </div>
    </div>

    <h3>–°–ø—Ä–∞–≤–∫–∞</h3>
    <p>–ü–µ—Ä–µ—Ç–∞—Å–∫–∏–≤–∞–π—Ç–µ –∫–æ–º–∞–Ω–¥—ã –≤ –ø–æ–ª–µ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –¥–ª—è –∏—Ö –¥–æ–±–∞–≤–ª–µ–Ω–∏—è.</p>
  </div>

  <!-- –°—Ä–µ–¥–Ω—è—è –∫–æ–ª–æ–Ω–∫–∞ (–†–∞–±–æ—á–µ–µ –ø–æ–ª–µ –¥–ª—è –∞–ª–≥–æ—Ä–∏—Ç–º–∞) -->
  <div class="middle-panel">
    <h3>–ê–ª–≥–æ—Ä–∏—Ç–º ‚ö° ({{ getTotalCommandCount() }}/{{ maxCommands }})</h3>
    
    <div class="algorithm-field">
      <form [formGroup]="algorithmForm">
        <div formArrayName="commands" class="algorithm">
    
          <div *ngFor="let command of commands.controls; let i = index" [formGroupName]="i" class="command-container">
            <app-command-block
              [control]="asFormGroup(command)"
              [parentArray]="commands"
              [index]="i"
              [getTotalCommandCount]="getTotalCommandCount"
              [maxCommands]="maxCommands"
              (dragCommand)="dragCommand($event.type, $event.array, $event.index)"
              (dropCommand)="dropCommand($event.index, $event.array)">
            </app-command-block>
          
            <div *ngIf="!isLastCommand(i, commands)" class="arrow-down"></div>
          </div>
    
          <!-- –ó–æ–Ω–∞ –≤—Å—Ç–∞–≤–∫–∏ –≤ –∫–æ–Ω–µ—Ü –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ -->
          <div class="drop-zone"
            (drop)="dropCommand(commands.length, commands)"
            (dragover)="onDragOver($event)">
            + –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–æ–Ω–µ—Ü –∞–ª–≥–æ—Ä–∏—Ç–º–∞
          </div>

          <!-- –ó–æ–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã -->
          <div class="garbage-zone"
            (drop)="handleDropOutside()"
            (dragover)="onDragOver($event)">
          üóëÔ∏è –ü–µ—Ä–µ—Ç–∞—â–∏ —Å—é–¥–∞ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è
          </div>
    
        </div>
      </form>
    </div>

    <button class="submit-button" (click)="submitSolution()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É</button>
  </div>

  <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
  <div class="right-panel">
    <h3>–ó–∞–¥–∞–Ω–∏–µ</h3>
    <p>{{ taskDescription }}</p>

    <h3>–ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ</h3>
    <!-- –ò–≥—Ä–æ–≤–æ–µ –ø–æ–ª–µ -->
    <div class="grid-container" [ngStyle]="gridStyle">
      <!-- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ async –ø–∞–π–ø —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—è -->
      <ng-container *ngIf="gameField$ | async as gameField; else loading">
        <div class="grid" *ngFor="let cell of gameField.layout_array; let i = index">
          <img *ngIf="cell !== -1"
               class="field-img"
               [src]="getElementImage(cell)"
               [ngStyle]="getElementStyle()" />
        </div>
      </ng-container>
      <ng-template #loading>
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ–ª—è...</div>
      </ng-template>
    </div>

    <h3>–ö–æ–Ω—Å–æ–ª—å</h3>
    <button *ngIf="!isRunning" (click)="runSolution()">‚ñ∂ Play</button>
    <button *ngIf="isRunning" (click)="stopSolution()">‚èπ Stop</button>
    <div class="console">
      <p *ngFor="let message of consoleMessages">{{ message }}</p>
    </div>
  </div>
</div>